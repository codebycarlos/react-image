{"version":3,"file":"useImage-a0d208eb.js","sources":["../jsSrc/imagePromiseFactory.js","../jsSrc/useImage.js"],"sourcesContent":["// returns a Promisized version of Image() api\nexport default ({ decode = true, crossOrigin = '' }) => (src) => {\n    return new Promise((resolve, reject) => {\n        const i = new Image();\n        if (crossOrigin)\n            i.crossOrigin = crossOrigin;\n        i.onload = () => {\n            decode && i.decode ? i.decode().then(resolve).catch(reject) : resolve();\n        };\n        i.onerror = reject;\n        i.src = src;\n    });\n};\n//# sourceMappingURL=imagePromiseFactory.js.map","import { useState } from 'react';\nimport imagePromiseFactory from './imagePromiseFactory';\nconst removeBlankArrayElements = (a) => a.filter((x) => x);\nconst stringToArray = (x) => (Array.isArray(x) ? x : [x]);\nconst cache = {};\n// sequential map.find for promises\nconst promiseFind = (arr, promiseFactory) => {\n    let done = false;\n    return new Promise((resolve, reject) => {\n        const queueNext = (src) => {\n            return promiseFactory(src).then(() => {\n                done = true;\n                resolve(src);\n            });\n        };\n        arr\n            .reduce((p, src) => {\n            // ensure we aren't done before enquing the next source\n            return p.catch(() => {\n                if (!done)\n                    return queueNext(src);\n            });\n        }, queueNext(arr.shift()))\n            .catch(reject);\n    });\n};\nexport default function useImage({ srcList, imgPromise = imagePromiseFactory({ decode: true }), useSuspense = true, }) {\n    const [, setIsLoading] = useState(true);\n    const sourceList = removeBlankArrayElements(stringToArray(srcList));\n    const sourceKey = sourceList.join('');\n    if (!cache[sourceKey]) {\n        // create promise to loop through sources and try to load one\n        cache[sourceKey] = {\n            promise: promiseFind(sourceList, imgPromise),\n            cache: 'pending',\n            error: null,\n        };\n    }\n    // when promise resolves/reject, update cache & state\n    cache[sourceKey].promise\n        // if a source was found, update cache\n        // when not using suspense, update state to force a rerender\n        .then((src) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'resolved', src };\n        if (!useSuspense)\n            setIsLoading(false);\n    })\n        // if no source was found, or if another error occured, update cache\n        // when not using suspense, update state to force a rerender\n        .catch((error) => {\n        cache[sourceKey] = { ...cache[sourceKey], cache: 'rejected', error };\n        if (!useSuspense)\n            setIsLoading(false);\n    });\n    if (cache[sourceKey].cache === 'resolved') {\n        return { src: cache[sourceKey].src, isLoading: false, error: null };\n    }\n    if (cache[sourceKey].cache === 'rejected') {\n        if (useSuspense)\n            throw cache[sourceKey].error;\n        return { isLoading: false, error: cache[sourceKey].error, src: undefined };\n    }\n    // cache[sourceKey].cache === 'pending')\n    if (useSuspense)\n        throw cache[sourceKey].promise;\n    return { isLoading: true, src: undefined, error: null };\n}\n//# sourceMappingURL=useImage.js.map"],"names":["decode","crossOrigin","src","Promise","resolve","reject","i","Image","onload","then","onerror","removeBlankArrayElements","a","filter","x","stringToArray","Array","isArray","cache","promiseFind","arr","promiseFactory","done","queueNext","reduce","p","shift","useImage","srcList","imgPromise","imagePromiseFactory","useSuspense","useState","setIsLoading","sourceList","sourceKey","join","promise","error","isLoading","undefined"],"mappings":";;;;;;;;;AAAA;AACA,0BAAe,CAAA,UAAA,IAAA,EAAA;AAAA,EAAA,IAAA,WAAA,GAAA,IAAA,CAAEA,MAAM;AAANA,IAAAA,MAAM,4BAAG,IAAI,GAAA,WAAA;AAAA,IAAA,gBAAA,GAAA,IAAA,CAAEC,WAAW;AAAXA,IAAAA,WAAW,iCAAG,EAAE,GAAA,gBAAA,CAAA;EAAA,OAC9C,UAACC,GAAG,EAAmB;AACrB,IAAA,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAI;AACrC,MAAA,IAAMC,CAAC,GAAG,IAAIC,KAAK,EAAE,CAAA;AACrB,MAAA,IAAIN,WAAW,EAAEK,CAAC,CAACL,WAAW,GAAGA,WAAW,CAAA;MAC5CK,CAAC,CAACE,MAAM,GAAG,YAAK;QACdR,MAAM,IAAIM,CAAC,CAACN,MAAM,GAAGM,CAAC,CAACN,MAAM,EAAE,CAACS,IAAI,CAACL,OAAO,CAAC,CAAM,OAAA,CAAA,CAACC,MAAM,CAAC,GAAGD,OAAO,EAAE,CAAA;OACxE,CAAA;MACDE,CAAC,CAACI,OAAO,GAAGL,MAAM,CAAA;MAClBC,CAAC,CAACJ,GAAG,GAAGA,GAAG,CAAA;AACb,KAAC,CAAC,CAAA;GACH,CAAA;AAAA,CAAA;;;;ACHH,IAAMS,wBAAwB,GAAG,SAA3BA,wBAAwB,CAAIC,CAAC,EAAA;AAAA,EAAA,OAAKA,CAAC,CAACC,MAAM,CAAC,UAACC,CAAC,EAAA;AAAA,IAAA,OAAKA,CAAC,CAAA;GAAC,CAAA,CAAA;AAAA,CAAA,CAAA;AAC1D,IAAMC,aAAa,GAAG,SAAhBA,aAAa,CAAID,CAAC,EAAA;EAAA,OAAME,KAAK,CAACC,OAAO,CAACH,CAAC,CAAC,GAAGA,CAAC,GAAG,CAACA,CAAC,CAAC,CAAA;AAAA,CAAC,CAAA;AACzD,IAAMI,KAAK,GAAG,EAAE,CAAA;AAEhB;AACA,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAIC,GAAG,EAAEC,cAAc,EAAI;EAC1C,IAAIC,IAAI,GAAG,KAAK,CAAA;AAChB,EAAA,OAAO,IAAInB,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAI;AACrC,IAAA,IAAMkB,SAAS,GAAG,SAAZA,SAAS,CAAIrB,GAAG,EAAI;AACxB,MAAA,OAAOmB,cAAc,CAACnB,GAAG,CAAC,CAACO,IAAI,CAAC,YAAK;AACnCa,QAAAA,IAAI,GAAG,IAAI,CAAA;QACXlB,OAAO,CAACF,GAAG,CAAC,CAAA;AACd,OAAC,CAAC,CAAA;KACH,CAAA;AAEDkB,IAAAA,GAAG,CACAI,MAAM,CAAC,UAACC,CAAC,EAAEvB,GAAG,EAAI;AACjB;MACA,OAAOuB,CAAC,CAAM,OAAA,CAAA,CAAC,YAAK;AAClB,QAAA,IAAI,CAACH,IAAI,EAAE,OAAOC,SAAS,CAACrB,GAAG,CAAC,CAAA;AAClC,OAAC,CAAC,CAAA;AACJ,KAAC,EAAEqB,SAAS,CAACH,GAAG,CAACM,KAAK,EAAE,CAAC,CAAC,CAAA,OAAA,CACpB,CAACrB,MAAM,CAAC,CAAA;AAClB,GAAC,CAAC,CAAA;AACJ,CAAC,CAAA;AAEa,SAAUsB,QAAQ,CAIhB,IAAA,EAAA;EAAA,IAHdC,OAAO,QAAPA,OAAO;AAAA,IAAA,eAAA,GAAA,IAAA,CACPC,UAAU;IAAVA,UAAU,GAAA,eAAA,KAAA,KAAA,CAAA,GAAGC,mBAAmB,CAAC;AAAC9B,MAAAA,MAAM,EAAE,IAAA;AAAI,KAAC,CAAC,GAAA,eAAA;AAAA,IAAA,gBAAA,GAAA,IAAA,CAChD+B,WAAW;AAAXA,IAAAA,WAAW,iCAAG,IAAI,GAAA,gBAAA,CAAA;EAElB,IAAyBC,SAAAA,GAAAA,cAAQ,CAAC,IAAI,CAAC;IAA9BC,YAAY,GAAA,SAAA,CAAA,CAAA,CAAA,CAAA;EACrB,IAAMC,UAAU,GAAGvB,wBAAwB,CAACI,aAAa,CAACa,OAAO,CAAC,CAAC,CAAA;AACnE,EAAA,IAAMO,SAAS,GAAGD,UAAU,CAACE,IAAI,CAAC,EAAE,CAAC,CAAA;AAErC,EAAA,IAAI,CAAClB,KAAK,CAACiB,SAAS,CAAC,EAAE;AACrB;IACAjB,KAAK,CAACiB,SAAS,CAAC,GAAG;AACjBE,MAAAA,OAAO,EAAElB,WAAW,CAACe,UAAU,EAAEL,UAAU,CAAC;AAC5CX,MAAAA,KAAK,EAAE,SAAS;AAChBoB,MAAAA,KAAK,EAAE,IAAA;AACR,KAAA,CAAA;;AAGH;EACApB,KAAK,CAACiB,SAAS,CAAC,CAACE,OAAAA;AACf;AACA;AAAA,GACC5B,IAAI,CAAC,UAACP,GAAG,EAAI;AACZgB,IAAAA,KAAK,CAACiB,SAAS,CAAC,mCAAOjB,KAAK,CAACiB,SAAS,CAAC,CAAA,EAAA,EAAA,EAAA;AAAEjB,MAAAA,KAAK,EAAE,UAAU;AAAEhB,MAAAA,GAAG,EAAHA,GAAAA;KAAI,CAAA,CAAA;AAChE,IAAA,IAAI,CAAC6B,WAAW,EAAEE,YAAY,CAAC,KAAK,CAAC,CAAA;GACtC,CAAA;AAED;AACA;GACM,OAAA,CAAA,CAAC,UAACK,KAAK,EAAI;AACfpB,IAAAA,KAAK,CAACiB,SAAS,CAAC,mCAAOjB,KAAK,CAACiB,SAAS,CAAC,CAAA,EAAA,EAAA,EAAA;AAAEjB,MAAAA,KAAK,EAAE,UAAU;AAAEoB,MAAAA,KAAK,EAALA,KAAAA;KAAM,CAAA,CAAA;AAClE,IAAA,IAAI,CAACP,WAAW,EAAEE,YAAY,CAAC,KAAK,CAAC,CAAA;AACvC,GAAC,CAAC,CAAA;EAEJ,IAAIf,KAAK,CAACiB,SAAS,CAAC,CAACjB,KAAK,KAAK,UAAU,EAAE;IACzC,OAAO;AAAChB,MAAAA,GAAG,EAAEgB,KAAK,CAACiB,SAAS,CAAC,CAACjC,GAAG;AAAEqC,MAAAA,SAAS,EAAE,KAAK;AAAED,MAAAA,KAAK,EAAE,IAAA;KAAK,CAAA;;EAGnE,IAAIpB,KAAK,CAACiB,SAAS,CAAC,CAACjB,KAAK,KAAK,UAAU,EAAE;IACzC,IAAIa,WAAW,EAAE,MAAMb,KAAK,CAACiB,SAAS,CAAC,CAACG,KAAK,CAAA;IAC7C,OAAO;AAACC,MAAAA,SAAS,EAAE,KAAK;AAAED,MAAAA,KAAK,EAAEpB,KAAK,CAACiB,SAAS,CAAC,CAACG,KAAK;AAAEpC,MAAAA,GAAG,EAAEsC,SAAAA;KAAU,CAAA;;AAG1E;EACA,IAAIT,WAAW,EAAE,MAAMb,KAAK,CAACiB,SAAS,CAAC,CAACE,OAAO,CAAA;EAC/C,OAAO;AAACE,IAAAA,SAAS,EAAE,IAAI;AAAErC,IAAAA,GAAG,EAAEsC,SAAS;AAAEF,IAAAA,KAAK,EAAE,IAAA;GAAK,CAAA;AACvD;;;;;"}